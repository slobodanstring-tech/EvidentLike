<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Kalendar Zakazivanja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      padding: 10px;
      background: #f5f5f5;
    }

    .page-month-header {
      font-size: 18px;
      font-weight: bold;
      text-align: left;
      padding: 10px 0 5px 5px;
    }

    .mobile-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: repeat(4, 1fr);
      gap: 10px;
      height: 100vh;
    }

    .cell {
      background: white;
      border-radius: 10px;
      padding: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .cell h3 {
      font-size: 14px;
      margin: 0 0 5px 0;
    }

    .event {
      font-size: 13px;
      margin-bottom: 4px;
      border-left: 3px solid #2196f3;
      padding-left: 6px;
      background-color: #e3f2fd;
      padding: 4px 6px;
      border-radius: 5px;
      cursor: pointer;
    }

    .calendar {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      font-weight: bold;
      font-size: clamp(8px, 1.2vw, 14px);
      margin-bottom: 2px;
    }

    .calendar-weekdays > div {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .calendar-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 1fr;
    }

    .calendar-day {
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: clamp(8px, 1.2vw, 14px);
      padding: 2px;
    }

    .calendar-day > span {
      display: inline-block;
      width: 100%;
      height: 100%;
      border-radius: 4px;
    }

    .today {
      background-color: #e0f2ff;
      border: 1px solid #2196f3;
    }

    .current-week {
      background-color: #fff8e1;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .modal-content {
      background: white;
      padding: 20px;
      width: 90%;
      max-width: 300px;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .modal-content input,
    .modal-content textarea {
      padding: 6px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .modal-content button {
      padding: 8px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #sacuvaj, #izmeni {
      background-color: #2196f3;
      color: white;
    }

    #otkazi, #zatvori-edit {
      background-color: #ccc;
    }

    .hidden {
      display: none;
    }
  </style>
</head>
<body>

<div class="page-month-header" id="page-month">Maj</div>

<div class="mobile-grid">
  <div class="cell calendar-cell">
    <div class="calendar">
      <div class="calendar-weekdays">
        <div>Po</div><div>Ut</div><div>Sr</div><div>Če</div><div>Pe</div><div>Su</div><div>Ne</div>
      </div>
      <div class="calendar-grid" id="calendar-grid"></div>
    </div>
  </div>

  <div class="cell"><h3>Ponedeljak</h3></div>
  <div class="cell"><h3>Utorak</h3></div>
  <div class="cell"><h3>Sreda</h3></div>
  <div class="cell"><h3>Četvrtak</h3></div>
  <div class="cell"><h3>Petak</h3></div>
  <div class="cell"><h3>Subota</h3></div>
  <div class="cell"><h3>Nedelja</h3></div>
</div>

<!-- Modal za dodavanje pacijenta -->
<div id="modal" class="modal hidden">
  <div class="modal-content">
    <h3>Dodaj pacijenta</h3>
    <input type="text" id="ime" placeholder="Ime i prezime" />
    <input type="text" id="vreme" placeholder="Vreme (npr. 10:30)" />
    <textarea id="napomena" placeholder="Beleška"></textarea>
    <button id="sacuvaj">Sačuvaj</button>
    <button id="otkazi">Otkaži</button>
  </div>
</div>

<!-- Modal za pregled/izmenu pacijenta -->
<div id="modal-edit" class="modal hidden">
  <div class="modal-content">
    <h3>Beleška pacijenta</h3>
    <input type="text" id="edit-ime" placeholder="Ime i prezime" />
    <input type="text" id="edit-vreme" placeholder="Vreme (npr. 10:30)" />
    <textarea id="edit-napomena" placeholder="Beleška"></textarea>
    <button id="izmeni">Sačuvaj izmene</button>
    <button id="zatvori-edit">Zatvori</button>
  </div>
</div>

<script>
  let aktivnaCelija = null;
  let trenutnoSelektovanPacijent = null;

  // Otvori modal za unos pacijenta
  document.querySelectorAll(".cell").forEach(cell => {
    const h3 = cell.querySelector("h3");
    if (h3) {
      cell.addEventListener("click", () => {
        aktivnaCelija = cell;
        document.getElementById("modal").classList.remove("hidden");
      });
    }
  });

  // Sačuvaj novog pacijenta
  document.getElementById("sacuvaj").addEventListener("click", () => {
    const ime = document.getElementById("ime").value.trim();
    const vreme = document.getElementById("vreme").value.trim();
    const napomena = document.getElementById("napomena").value.trim();

    if (!ime || !vreme) return alert("Ime i vreme su obavezni!");

    const nova = document.createElement("div");
    nova.classList.add("event");
    nova.textContent = `${vreme} – ${ime}`;
    nova.dataset.ime = ime;
    nova.dataset.vreme = vreme;
    nova.dataset.napomena = napomena;

    aktivnaCelija.appendChild(nova);

    document.getElementById("modal").classList.add("hidden");
    document.getElementById("ime").value = "";
    document.getElementById("vreme").value = "";
    document.getElementById("napomena").value = "";
  });

  document.getElementById("otkazi").addEventListener("click", () => {
    document.getElementById("modal").classList.add("hidden");
  });

  // Klik na pacijenta
  document.addEventListener("click", function (e) {
    if (e.target.classList.contains("event")) {
      trenutnoSelektovanPacijent = e.target;

      document.getElementById("edit-ime").value = e.target.dataset.ime || "";
      document.getElementById("edit-vreme").value = e.target.dataset.vreme || "";
      document.getElementById("edit-napomena").value = e.target.dataset.napomena || "";

      document.getElementById("modal-edit").classList.remove("hidden");
    }
  });

  document.getElementById("zatvori-edit").addEventListener("click", () => {
    document.getElementById("modal-edit").classList.add("hidden");
  });

  document.getElementById("izmeni").addEventListener("click", () => {
    if (!trenutnoSelektovanPacijent) return;

    const ime = document.getElementById("edit-ime").value.trim();
    const vreme = document.getElementById("edit-vreme").value.trim();
    const napomena = document.getElementById("edit-napomena").value.trim();

    trenutnoSelektovanPacijent.textContent = `${vreme} – ${ime}`;
    trenutnoSelektovanPacijent.dataset.ime = ime;
    trenutnoSelektovanPacijent.dataset.vreme = vreme;
    trenutnoSelektovanPacijent.dataset.napomena = napomena;

    document.getElementById("modal-edit").classList.add("hidden");
  });

  // Kalendar generacija
  function generateCalendar(year, month) {
    const grid = document.getElementById("calendar-grid");
    grid.innerHTML = "";

    const date = new Date(year, month, 1);
    const firstDay = (date.getDay() + 6) % 7;
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const today = new Date();

    const totalCells = firstDay + daysInMonth;
    const totalRows = Math.ceil(totalCells / 7);
    const totalSlots = totalRows * 7;

    const dayElements = [];

    for (let i = 0; i < totalSlots; i++) {
      const dayCell = document.createElement("div");
      dayCell.classList.add("calendar-day");

      const dayNumber = i - firstDay + 1;

      const inner = document.createElement("span");
      if (i >= firstDay && dayNumber <= daysInMonth) {
        inner.textContent = dayNumber;
      } else {
        inner.textContent = "";
      }

      dayCell.appendChild(inner);
      grid.appendChild(dayCell);
      dayElements.push(inner);
    }

    if (year === today.getFullYear() && month === today.getMonth()) {
      const todayIndex = firstDay + today.getDate() - 1;
      dayElements[todayIndex].classList.add("today");

      const weekStart = todayIndex - (todayIndex % 7);
      const weekEnd = weekStart + 6;
      for (let i = weekStart; i <= weekEnd; i++) {
        if (dayElements[i]) {
          dayElements[i].classList.add("current-week");
        }
      }
    }

    const monthNames = [
      "Januar", "Februar", "Mart", "April", "Maj", "Jun",
      "Jul", "Avgust", "Septembar", "Oktobar", "Novembar", "Decembar"
    ];

    document.getElementById("page-month").textContent = monthNames[month];
  }

  generateCalendar(2025, 4); // Maj 2025
</script>

</body>
</html>
